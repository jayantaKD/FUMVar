import sys
import os
from argparse import ArgumentParser
import lief
import gp
import analysis as anal
import time

if __name__ == "__main__":
    parser = ArgumentParser()
    parser.add_argument("-i", type=str, help="Path for binary input", dest="input_path", required=False)
    parser.add_argument("-o", type=str, help="Path for result", dest="output_path", required=False)
    parser.add_argument("-p", type=int, help="Number of population (default=4)", dest="population")
    parser.add_argument("-m", type=int, help="Number of perturbation per generation (default=4)", dest="perturbation")
    parser.add_argument("-g", type=int, help="Number of generation (default=100)", dest="generation")
    parser.add_argument("-s", type=int, help="Number of skip time for VirusTotal scan generation (default=5)",
                        dest="skip")

    args = parser.parse_args()
    population = 2
    perturbation = 1
    generation = 10
    skip = 20
    input_path = '/home/infobeyond/VirusShare/VirusShare_PE'
    output_path = '/home/infobeyond/VirusShare/output2'

    if args.population:
        population = args.population
    if args.perturbation:
        perturbation = args.perturbation
    if args.generation:
        generation = args.generation
    if args.skip:
        skip = args.skip
    if args.input_path:
        input_path = args.input_path
    if args.output_path:
        output_path = args.output_path

    fbytes = open(input_path, "rb").read()
    #print(fbytes)
    fparsed = lief.parse(fbytes)
    print(lief.is_elf(fbytes))

    data1 = anal.creat_v2_jotti_scan_token()
    print(data1)
    data2 = anal.create_v2_jotti_scan_job(input_path, data1)
    print(data2)

    #time.sleep(30)
    data3 = anal.get_v2_jotti_scan_job_status(data2)
    print(data3)
    print(data3['scanJob']['finishedOn'])
    if data3['scanJob']['finishedOn'] == None:
        print(data3['scanJob']['finishedOn'])

    data4 = anal.get_v2_jotti_scan_job_result('936b5b56ec389901a303a3ad6551ddda')
    print(data4)

# 936b5b56ec389901a303a3ad6551ddda
